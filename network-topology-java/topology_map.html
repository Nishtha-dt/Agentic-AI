<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Network Topology Map</title>
<script src="https://d3js.org/d3.v6.min.js"></script>
<style>
    body { font-family: Arial, sans-serif; }
    .node text { font-size: 10px; }
    .link { stroke: #999; stroke-opacity: 0.6; }
    .info-panel {
        position: fixed;
        right: 10px;
        top: 10px;
        background: #f9f9f9;
        padding: 10px;
        border: 1px solid #ccc;
        width: 250px;
        height: 90%;
        overflow-y: auto;
    }
</style>
</head>
<body>

<h2>5G Network Topology - Site Based Layout</h2>
<div id="topology"></div>
<div class="info-panel" id="info">
    <h3>Node Details</h3>
    <p>Click a node to see details</p>
</div>

<script>
// Node data with site positions
const nodes = [
    // Site A
    {id: "SiteA", group: "Site", x: 200, y: 200},
    {id: "Router1", type: "Router", site: "SiteA"},
    {id: "Router2", type: "Router", site: "SiteA"},
    {id: "Switch1", type: "Switch", site: "SiteA"},
    {id: "Server1", type: "Server", site: "SiteA"},
    {id: "Server2", type: "Server", site: "SiteA"},
    {id: "Firewall1", type: "Firewall", site: "SiteA"},
    {id: "AccessPoint1", type: "AP", site: "SiteA"},
    {id: "gNodeB1", type: "gNodeB", site: "SiteA"},

    // Core Site
    {id: "CoreSite", group: "Site", x: 600, y: 200},
    {id: "AMF1", type: "CoreNF", site: "CoreSite"},
    {id: "SMF1", type: "CoreNF", site: "CoreSite"},
    {id: "UPF1", type: "CoreNF", site: "CoreSite"},

    // Edge Site
    {id: "EdgeSite", group: "Site", x: 600, y: 500},
    {id: "EdgeServer1", type: "EdgeServer", site: "EdgeSite"},
    {id: "EdgeServer2", type: "EdgeServer", site: "EdgeSite"}
];

// Links between devices (simplified)
const links = [
    {source: "Router1", target: "Router2", bandwidth: "1G"},
    {source: "Router1", target: "Switch1", bandwidth: "1G"},
    {source: "Switch1", target: "Server1", bandwidth: "1G"},
    {source: "Switch1", target: "Server2", bandwidth: "1G"},
    {source: "Switch1", target: "Firewall1", bandwidth: "1G"},
    {source: "Switch1", target: "AccessPoint1", bandwidth: "1G"},
    {source: "Router2", target: "gNodeB1", bandwidth: "10G"},
    {source: "gNodeB1", target: "Router1", bandwidth: "10G"},
    {source: "Router1", target: "UPF1", bandwidth: "10G"},
    {source: "UPF1", target: "EdgeServer1", bandwidth: "10G"},
    {source: "UPF1", target: "EdgeServer2", bandwidth: "10G"},
    {source: "AMF1", target: "SMF1", bandwidth: "10G"},
    {source: "SMF1", target: "UPF1", bandwidth: "10G"}
];

// Color by type
const colorMap = {
    "Router": "#1f77b4",
    "Switch": "#2ca02c",
    "Server": "#ff7f0e",
    "Firewall": "#d62728",
    "AP": "#9467bd",
    "gNodeB": "#8c564b",
    "CoreNF": "#e377c2",
    "EdgeServer": "#17becf",
    "Site": "#7f7f7f"
};

const width = 900, height = 700;
const svg = d3.select("#topology").append("svg")
    .attr("width", width)
    .attr("height", height);

// Create simulation
const simulation = d3.forceSimulation(nodes)
    .force("link", d3.forceLink(links).id(d => d.id).distance(120))
    .force("charge", d3.forceManyBody().strength(-300))
    .force("center", d3.forceCenter(width / 2, height / 2))
    .force("x", d3.forceX().x(d => d.site === "SiteA" ? 200 : d.site === "CoreSite" ? 600 : 600))
    .force("y", d3.forceY().y(d => d.site === "SiteA" ? 200 : d.site === "CoreSite" ? 200 : 500));

// Draw links
const link = svg.append("g")
    .attr("stroke", "#999")
    .selectAll("line")
    .data(links)
    .enter().append("line")
    .attr("stroke-width", 2);

// Draw link labels
const linkLabels = svg.append("g")
    .selectAll("text")
    .data(links)
    .enter().append("text")
    .attr("font-size", 8)
    .attr("fill", "#555")
    .text(d => d.bandwidth);

// Draw nodes
const node = svg.append("g")
    .selectAll("circle")
    .data(nodes)
    .enter().append("circle")
    .attr("r", d => d.group === "Site" ? 25 : 12)
    .attr("fill", d => colorMap[d.type] || colorMap[d.group])
    .call(drag(simulation))
    .on("click", showInfo);

// Node labels
const labels = svg.append("g")
    .selectAll("text")
    .data(nodes)
    .enter().append("text")
    .text(d => d.id)
    .attr("font-size", 10)
    .attr("dy", -15);

// Dragging
function drag(simulation) {
    function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
    }
    function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
    }
    function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
    }
    return d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended);
}

// Show node info
function showInfo(event, d) {
    const info = document.getElementById("info");
    info.innerHTML = `<h3>${d.id}</h3><p>Type: ${d.type || d.group}</p><p>Site: ${d.site || "N/A"}</p>`;
}

// Simulation tick
simulation.on("tick", () => {
    link
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);
    
    linkLabels
        .attr("x", d => (d.source.x + d.target.x) / 2)
        .attr("y", d => (d.source.y + d.target.y) / 2);

    node
        .attr("cx", d => d.x)
        .attr("cy", d => d.y);

    labels
        .attr("x", d => d.x)
        .attr("y", d => d.y);
});
</script>
</body>
</html>
